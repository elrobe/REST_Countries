<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Country Search</title>
    <script type="text/javascript" src="jquery-3.2.1.min.js"></script>
    <style>
      
      .error {
        color: red;
      }
      
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        text-align: center;
      }
      
      th {
        font-size: 11px;
      }
      
    </style>
  </head>
  <body>
    
    <h1>Country Search</h1>
    <p>Search for countries by name. It can be the native name or partial name.</p>
    
    <!-- A simple form for the user input. -->
    <div id="search">
      <form id="form">
        <text>Country: </text>
        <input type="text" id="country" name="country"/>
        <input type="submit" value="Search"/>
      </form>
    </div>
    
    <!-- This will be a placeholder for the search results. -->
    <div id="results" visible="false">
      <!--<p id="error"></p>
      <table id="1"></p>
      <p id="2"></p>-->
    </div>
    
    <script>
      var columns = ['name', 'population', 'alpha2Code', 'alpha3Code', 'flag', 'region', 'subregion', 'languages'];
    
      // Make sure the text input is cleared on startup to not carry over values.
      $("#country").val("");
      
      // Prevent the page from reloading then validate the input.
      $("#form").submit(function(event) { 
        $("#results").html(""); // Make sure the results table is cleared
        event.preventDefault();
        sendQuery();
      })
      
      function sendQuery()
      {
        $.ajax({
          type: "post",
          url: "countries.php",
          data: $("#form").serialize(),
          success: function( data ) {
            processData( data );
          }
        });
      }
      
      function processData( data )
      {
        var obj = JSON.parse( data );
        
        console.log( "Count: " + obj.count );
        console.log( "Error? " + !(obj.error==null) );
        
        if ( obj.error != null )
        {
          console.log( "Error found!" );
          var $error = $( "<h2>", { "class": "error" } );
          $error.html( obj.error );
          $("#results").append( $error );
          return;
        }
        
        var $header = $( "<h2>" );
        $header.html( obj.count + " countries found:" );
        
        var $table = $( "<table>" );
        var $tbody = $( "<tbody>" );
        $table.append( $tbody );
        var $tr = $( "<tr>" );
        var $th = $( "<th>" );
        $tr.append( $th ); // Empty header
        // Create the column headers
        for ( var i = 0; i < columns.length; i++ )
        {
          $th = $( "<th>" );
          $th.html( columns[i].toUpperCase() );
          $tr.append( $th );
        }
        $tbody.append( $tr );
        
        var countries = obj.data;
        for ( var c = 0; c < countries.length; c++ )
        {
          $tr = $( "<tr>" );
          var $td = $( "<td>" );
          $td.html( c );
          $tr.append( $td );
          for ( var i = 0; i < columns.length; i++ )
          {
            $td = $( "<td>" );
            $td.html( countries[c][ columns[i] ] );
            $tr.append( $td );
          }
          $tbody.append( $tr );
        }
        
        $("#results").append( $header );
        $("#results").append( $table );
      }
    </script>
  </body>
</html>
